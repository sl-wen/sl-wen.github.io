# SSHè¿æ¥è°ƒè¯•å·¥ä½œæµ
name: Debug SSH Connection

# æ‰‹åŠ¨è§¦å‘
on:
  workflow_dispatch:

jobs:
  debug-ssh:
    runs-on: ubuntu-latest
    
    steps:
      - name: Test SSH Connection
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_KEY }}
          port: 22
          timeout: 30s
          debug: true
          script: |
            echo "ğŸ” SSHè¿æ¥è°ƒè¯•ä¿¡æ¯"
            echo "=================="
            
            # ç³»ç»Ÿä¿¡æ¯
            echo "ğŸ“‹ ç³»ç»Ÿä¿¡æ¯:"
            uname -a
            whoami
            pwd
            
            # æ£€æŸ¥ç›®å½•
            echo ""
            echo "ğŸ“ ç›®å½•æ£€æŸ¥:"
            ls -la /var/www/
            
            if [ -d "/var/www/blog" ]; then
                echo "âœ… /var/www/blog ç›®å½•å­˜åœ¨"
                cd /var/www/blog
                ls -la
                
                # GitçŠ¶æ€
                if [ -d ".git" ]; then
                    echo ""
                    echo "ğŸ“‹ GitçŠ¶æ€:"
                    git status
                    git remote -v
                    git branch -a
                else
                    echo "âŒ ä¸æ˜¯Gitä»“åº“"
                fi
            else
                echo "âŒ /var/www/blog ç›®å½•ä¸å­˜åœ¨"
            fi
            
            # Node.jsç¯å¢ƒ
            echo ""
            echo "ğŸ“‹ Node.jsç¯å¢ƒ:"
            which node && node --version || echo "âŒ Node.jsæœªå®‰è£…"
            which npm && npm --version || echo "âŒ npmæœªå®‰è£…"
            
            # æœåŠ¡çŠ¶æ€
            echo ""
            echo "ğŸ“‹ æœåŠ¡çŠ¶æ€:"
            sudo systemctl is-active blog || echo "blogæœåŠ¡æœªè¿è¡Œ"
            sudo systemctl status blog --no-pager -l || echo "blogæœåŠ¡ä¸å­˜åœ¨"
            
            # ç«¯å£æ£€æŸ¥
            echo ""
            echo "ğŸ“‹ ç«¯å£æ£€æŸ¥:"
            sudo netstat -tlnp | grep :3000 || echo "ç«¯å£3000æœªè¢«å ç”¨"
            
            # æƒé™æ£€æŸ¥
            echo ""
            echo "ğŸ“‹ æƒé™æ£€æŸ¥:"
            ls -la /var/www/blog/ | head -10
            
            echo ""
            echo "ğŸ‰ è°ƒè¯•ä¿¡æ¯æ”¶é›†å®Œæˆï¼"

      - name: Test Simple Commands
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_KEY }}
          port: 22
          timeout: 30s
          script: |
            echo "ğŸ§ª æµ‹è¯•åŸºæœ¬å‘½ä»¤"
            echo "=============="
            
            # æµ‹è¯•sudoæƒé™
            echo "æµ‹è¯•sudoæƒé™:"
            sudo whoami || echo "âŒ sudoæƒé™æµ‹è¯•å¤±è´¥"
            
            # æµ‹è¯•ç½‘ç»œè¿æ¥
            echo "æµ‹è¯•ç½‘ç»œè¿æ¥:"
            curl -I http://localhost:3000 || echo "âŒ æœ¬åœ°3000ç«¯å£æ— å“åº”"
            
            # æµ‹è¯•Gitè¿æ¥
            echo "æµ‹è¯•Gitè¿æ¥:"
            git ls-remote https://github.com/sl-wen/sl-wen.github.io.git || echo "âŒ Gitè¿æ¥å¤±è´¥"
            
            echo "ğŸ‰ åŸºæœ¬å‘½ä»¤æµ‹è¯•å®Œæˆï¼" 