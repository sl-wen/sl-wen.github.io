---
layout: page
title: 首页
---
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ site.title }}</title>
    <!-- Firebase SDK -->
    <script src="{{site.baseurl}}/static/js/firebase-app.js" type="module"></script>
    <script src="{{site.baseurl}}/static/js/firebase-firestore.js" type="module"></script>
    <script src="{{site.baseurl}}/static/js/marked.esm.js" type="module"></script>
    
    <script type="module">
        // 加载本地模块
        import { initializeApp } from '{{site.baseurl}}/static/js/firebase-app.js';
        import { getFirestore, collection, getDocs } from '{{site.baseurl}}/static/js/firebase-firestore.js';
        import { marked } from '{{site.baseurl}}/static/js/marked.esm.js';

        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyCuXDfNvLwiISoMwzcUIwUbaPTl69uRnao",
            authDomain: "slwen-45838.firebaseapp.com",
            projectId: "slwen-45838",
            storageBucket: "slwen-45838.appspot.com",
            messagingSenderId: "734137620659",
            appId: "1:734137620659:web:81ce8b971dce766d67b8c6",
            measurementId: "G-WEBZLW3S59"
        };

        // 页面加载完成后执行
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const statusDiv = document.getElementById('status-messages');
                statusDiv.innerHTML += '<p>开始初始化 Firebase...</p>';
                
                // 初始化 Firebase
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                statusDiv.innerHTML += '<p>Firebase 初始化成功</p>';
                
                // 获取文章列表容器
                const container = document.getElementById('posts-container');
                container.innerHTML = '<div class="loading">加载中...</div>';
                
                // 尝试获取文章
                statusDiv.innerHTML += '<p>开始从 Firestore 获取文章数据...</p>';
                const postsRef = collection(db, "posts");
                const querySnapshot = await getDocs(postsRef);
                
                statusDiv.innerHTML += `<p>查询完成，找到 ${querySnapshot.size} 篇文章</p>`;
                
                if (querySnapshot.empty) {
                    container.innerHTML = '<div class="no-posts">暂无文章，请先<a href="/pages/post.html">发布一篇文章</a></div>';
                    return;
                }
                
                // 显示文章
                let postsHtml = '';
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    statusDiv.innerHTML += `<p>找到文章: ID=${doc.id}, 标题=${data.title || '无标题'}</p>`;
                    
                    const date = data.createdAt ? data.createdAt.toDate() : new Date();
                    const dateStr = date.toLocaleDateString();
                    
                    postsHtml += `
                        <div class="post-item">
                            <h3>${data.title || '无标题'}</h3>
                            <p>作者: ${data.author || '未知'} | 日期: ${dateStr}</p>
                            <div>${data.content ? marked(data.content) : '无内容'}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = postsHtml;
                statusDiv.innerHTML += '<p>文章渲染完成</p>';
                
            } catch (error) {
                console.error('出错:', error);
                document.getElementById('status-messages').innerHTML += `
                    <p style="color: red;">错误: ${error.message}</p>
                    <p>错误详情: ${JSON.stringify(error)}</p>
                `;
                document.getElementById('posts-container').innerHTML = `
                    <div class="error">加载文章失败，请查看控制台和下方错误信息</div>
                `;
            }
        });
    </script>
    <style>
        .debug-panel {
            margin: 20px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-panel h3 {
            margin-top: 0;
        }
        .debug-panel p {
            margin: 5px 0;
            font-family: monospace;
        }
        .post-item {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fff;
        }
        .error {
            color: red;
            padding: 15px;
            border: 1px solid red;
            background: #fff8f8;
            border-radius: 5px;
        }
        .no-posts {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
<div class="page page-index">
    <div class="firebase-posts">
        <div class="debug-panel">
            <h3>调试信息</h3>
            <div id="status-messages">
                <p>页面加载中...</p>
            </div>
        </div>
        
        <div id="posts-container"></div>
    </div>
</div>
</body>
</html>