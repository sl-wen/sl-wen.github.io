<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#24292e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"> <!-- 设置移动设备的视口属性 -->
    <title>重置密码 - 我的博客</title>
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/login.css">
     
    <script src="/static/js/common-components.js"></script>
    <script src="/static/js/dist/stats.bundle.js"></script>
    <script src="/static/js/click-effect.js"></script>
    <script src="/static/js/dist/auth.bundle.js"></script>
</head>
<body>
    <div class="page">
        <div id="common-header"></div>

        <div class="container">
            <div class="loign-container">
                <h2>重置密码</h2>
                <form id="reset-password-form" class="displaydiv active">
                    <div class="login-group">
                        <label for="new-password">新密码</label>
                        <input type="password" id="new-password" name="password">
                    </div>
                    <div class="login-group">
                        <label for="confirm-password">确认密码</label>
                        <input type="password" id="confirm-password" name="confirm-password">
                    </div>
                    <div class="buttons">
                        <button type="submit" id="reset-btn" class="primary-btn">更新密码</button>
                    </div>
                </form>
            </div>
            <div id="message-container">
                <div id="status-messages"></div>
            </div>
        </div>

        <div id="common-footer"></div>
    </div>

    <script>
        import { supabase } from '/static/js/supabase-config.js';

        function showMessage(message, type = 'info') {
            const container = document.getElementById('message-container');
            if (!container) return;

            container.innerHTML = `
                <div class="${type}-message">
                    ${message}
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const resetForm = document.getElementById('reset-password-form');
            if (resetForm) {
                resetForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const password = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;

                    if (!password || !confirmPassword) {
                        showMessage('请填写所有字段', 'error');
                        return;
                    }

                    if (password !== confirmPassword) {
                        showMessage('两次输入的密码不一致', 'error');
                        return;
                    }

                    try {
                        const { error } = await supabase.auth.updateUser({
                            password: password
                        });

                        if (error) throw error;

                        showMessage('密码已成功更新！', 'success');
                        setTimeout(() => {
                            window.location.href = '/pages/login.html';
                        }, 2000);
                    } catch (error) {
                        showMessage(error.message || '更新密码失败', 'error');
                    }
                });
            }
        });
    </script>
</body>
</html>